<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="en_US" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Learn about the dart:io library and APIs.">
  <title>A Tour of the dart:io Library | Dart</title>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/touch-icon-iphone.png" rel="apple-touch-icon">
  <link href="/assets/touch-icon-ipad.png" rel="apple-touch-icon" sizes="76x76">
  <link href="/assets/touch-icon-iphone-retina.png" rel="apple-touch-icon" sizes="120x120">
  <link href="/assets/touch-icon-ipad-retina.png" rel="apple-touch-icon" sizes="152x152">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@dart_lang" />
  <meta name="twitter:title" content="A Tour of the dart:io Library" />
  <meta name="twitter:description" content="Learn about the dart:io library and APIs." />

  <!-- Open Graph -->
  <meta property="og:title" content="A Tour of the dart:io Library" />
  <meta property="og:description" content="Learn about the dart:io library and APIs." />
  <meta property="og:url" content="https://www.dartlang.org/dart-vm/io-library-tour" />
  <meta property="og:image" content="https://www.dartlang.org/assets/shared/dart-logo-for-shares.png?2" />

  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700' rel='stylesheet' type='text/css'>
  <link type="text/css" rel="stylesheet" href="/assets/style.css">
  
  <!--
    Why don't we use Dart here?

    The only scripting we use here is stuff like the on-click footnotes on the
    front page or resizing of the left nav. These happen to be use cases where
    JavaScript and jQuery are doing just fine. Dart is here for application
    programming, not page scripting.
   -->
  <script type="text/javascript" src="/assets/main.js"></script>
  
  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26406144-4', 'auto');
ga('send', 'pageview');

</script>


</head>

  <body class="default">
    <header id="page-header">
  <nav id="mainnav">
  <div id="menu-toggle"><i class="icon icon-menu"></i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/shared/dart/logo+text/horizontal/default.svg" alt="Dart">
  </a>
  <ul>
    <li class="mainnav__get-started"><a href="/guides/get-started"><span>入门</span></a></li>
    <li><a href="/guides/language">语言</a></li>
    <li><a href="/guides/libraries">库</a></li>
    <li><a href="/tools">工具</a></li>
    
    
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dart 2 <span class="caret"></span></a>
      <ul class="dropdown-menu">
        

<li><a href="https://v1-dartlang-org.firebaseapp.com/dart-vm/io-library-tour" class="no-automatic-external">1.24.3&nbsp;&nbsp;(archive)</a></li><li><a class="active">2.0.0&nbsp;&nbsp;(beta)</a></li>

        <li role="separator" class="divider"></li>
        <li><a href="/dart-2#migration">迁移指南</a></li>
      </ul>
    </li>
    
    <li class="searchfield">
      <form class="navbar-search" action="/search" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input type="search" name="q" id="q" autocomplete="off" placeholder="Search">
        <button type="submit"><i class="icon icon-search"></i></button>
      </form>
    </li>
  </ul>
</nav>

  
</header>

    <main id="page-content">
      <div id="sidenav" class="">
  <div class="content">
    <a href="/" class="brand" title="Dart">
      <img src="/assets/shared/dart/logo+text/horizontal/default.svg" alt="Dart">
    </a>

    <div class="sidenav__search">
      <p>
        <a href="/search">Search <i class="icon icon-search"></i></a>
      </p>
    </div>

    <ul>
      <li>
        <a class="btn btn-default" href="/guides/get-started">入门</a>
      </li>
    </ul>
    <h4 ><a href="/guides/language" title="语言">语言</a></h4>
  <ul><li >
          <a href="/guides/language/language-tour" title="概览">概览</a>
        </li>
        
        <li >
          <a href="/guides/language/effective-dart" title="Effective Dart">Effective Dart</a>
          <i class="icon icon-arrow"></i>
          <ul><li >
                <a href="/guides/language/effective-dart/style" title="风格">风格</a>
              </li><li >
                <a href="/guides/language/effective-dart/documentation" title="文档">文档</a>
              </li><li >
                <a href="/guides/language/effective-dart/usage" title="使用">使用</a>
              </li><li >
                <a href="/guides/language/effective-dart/design" title="设计">设计</a>
              </li>
          </ul><li >
          <a href="/samples" title="示例代码">示例代码</a>
        </li>
  </ul><h4 ><a href="/guides/libraries" title="库">库</a></h4>
  <ul><li >
          <a href="/guides/libraries/library-tour" title="概览">概览</a>
        </li>
  </ul><h4 ><a href="/guides/platforms" title="平台">平台</a></h4>
  <ul><li >
          <a href="https://flutter.io" title="移动端 (Flutter)">移动端 (Flutter)</a>
        </li><li >
          <a href="https://webdev.dartlang.org" title="web">web</a>
        </li><li class="active">
          <a href="/dart-vm" title="服务器">服务器</a>
        </li>
  </ul><h4 ><a href="/guides/testing" title="测试">测试</a></h4>
  <ul>
  </ul><h4 >资源</h4>
  <ul><li >
          <a href="/install" title="安装">安装</a>
        </li><li >
          <a href="/codelabs" title="Codelabs">Codelabs</a>
        </li><li >
          <a href="/tutorials" title="学习指南">学习指南</a>
        </li><li >
          <a href="/articles" title="文章">文章</a>
        </li><li >
          <a href="/tools" title="工具">工具</a>
        </li><li >
          <a href="/community" title="社区支持">社区支持</a>
        </li>
  </ul>
  </div>
</div>

      
<div id="toc">
  <div class="content">
    <h4>目录
      <a href="#page-content" title="Back to top" class="pull-right"><i class="icon icon-caret-up"></i></a>
    </h4>
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#files-and-directories">Files and directories</a>
<ul>
<li class="toc-entry toc-h3"><a href="#reading-a-file-as-text">Reading a file as text</a></li>
<li class="toc-entry toc-h3"><a href="#reading-a-file-as-binary">Reading a file as binary</a></li>
<li class="toc-entry toc-h3"><a href="#handling-errors">Handling errors</a></li>
<li class="toc-entry toc-h3"><a href="#streaming-file-contents">Streaming file contents</a></li>
<li class="toc-entry toc-h3"><a href="#writing-file-contents">Writing file contents</a></li>
<li class="toc-entry toc-h3"><a href="#listing-files-in-a-directory">Listing files in a directory</a></li>
<li class="toc-entry toc-h3"><a href="#other-common-functionality">Other common functionality</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#http-clients-and-servers">HTTP clients and servers</a>
<ul>
<li class="toc-entry toc-h3"><a href="#http-server">HTTP server</a></li>
<li class="toc-entry toc-h3"><a href="#http-client">HTTP client</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#more-information">More information</a></li>
</ul>
  </div>
</div>


      <article>
        <div class="content">
          <div class="banner alert alert-info">
  <p class="banner__text">
    <a href="https://medium.com/dartlang/dart-2-stable-and-the-dart-web-platform-3775d5f8eac7" target="_blank" rel="noopener"><b>Dart 2</b> 稳定版发布！</a>
    <a href="/dart-2#migration">迁移代码</a> 或
    <a href="/install">安装 Dart</a>.
  </p>
</div>

          

          
          <div>
            <ul class="page-github-links-menu" role="group">
  <li>
    <a href="https://github.com/dart-lang/site-www/tree/master/src_zh_CN/dart-vm/io-library-tour.md"
      class="no-automatic-external"
      title="View page source"
      target="_blank" rel="noopener">
      <i class="fab fa-github fa-sm"></i>
    </a>
  </li>
  <li>
    <a href="https://github.com/dart-lang/site-www/issues/new?title='A Tour of the dart:io Library' page issue&body=From URL: https://www.dartlang.org/dart-vm/io-library-tour"
      class="no-automatic-external"
      title="Report a bug on this page" target="_blank" rel="noopener">
      <i class="fas fa-bug fa-sm"></i>
    </a>
  </li>
</ul>

            <h1>A Tour of the dart:io Library</h1>
          </div>
          <?code-excerpt plaster="none"?>

<p>The <a href="https://api.dartlang.org/stable/dart-io/dart-io-library.html">dart:io</a> library provides APIs to deal with
files, directories, processes, sockets, WebSockets, and HTTP
clients and servers.</p>

<div class="alert alert-warning">
  <p><strong>Important:</strong>
  Only <a href="https://flutter.io">Flutter mobile apps</a>, command-line scripts, and servers
  can import and use <code class="highlighter-rouge">dart:io</code>, not web apps.</p>
</div>

<p>In general, the dart:io library implements and promotes an asynchronous
API. Synchronous methods can easily block an application, making it
difficult to scale. Therefore, most operations return results via Future
or Stream objects, a pattern common with modern server platforms such as
Node.js.</p>

<p>The few synchronous methods in the dart:io library are clearly marked
with a Sync suffix on the method name. Synchronous methods aren’t covered here.</p>

<p>To use the dart:io library you must import it:
<?code-excerpt "misc/test/library_tour/io_test.dart (import)"?></p>
<pre class="prettyprint lang-dart">import 'dart:io';</pre>

<h2 id="files-and-directories">
<a id="files-and-directories" class="anchor" href="#files-and-directories" aria-hidden="true"><span class="octicon octicon-link"></span></a>Files and directories</h2>

<p>The I/O library enables command-line apps to read and write files and
browse directories. You have two choices for reading the contents of a
file: all at once, or streaming. Reading a file all at once requires
enough memory to store all the contents of the file. If the file is very
large or you want to process it while reading it, you should use a
Stream, as described in
<a href="#streaming-file-contents">Streaming file contents</a>.</p>

<h3 id="reading-a-file-as-text">
<a id="reading-a-file-as-text" class="anchor" href="#reading-a-file-as-text" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reading a file as text</h3>

<p>When reading a text file encoded using UTF-8, you can read the entire
file contents with <code class="highlighter-rouge">readAsString()</code>. When the individual lines are
important, you can use <code class="highlighter-rouge">readAsLines()</code>. In both cases, a Future object
is returned that provides the contents of the file as one or more
strings.</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (readAsString)" replace="/\btest_data\///g"?>
<pre class="prettyprint lang-dart">Future main() async {
  var config = File('config.txt');
  var contents;

  // Put the whole file in a single string.
  contents = await config.readAsString();
  print('The file is ${contents.length} characters long.');

  // Put each line of the file into its own string.
  contents = await config.readAsLines();
  print('The file is ${contents.length} lines long.');
}</pre>

<h3 id="reading-a-file-as-binary">
<a id="reading-a-file-as-binary" class="anchor" href="#reading-a-file-as-binary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reading a file as binary</h3>

<p>The following code reads an entire file as bytes into a list of ints.
The call to <code class="highlighter-rouge">readAsBytes()</code> returns a Future, which provides the result
when it’s available.</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (readAsBytes)" replace="/\btest_data\///g"?>
<pre class="prettyprint lang-dart">Future main() async {
  var config = File('config.txt');

  var contents = await config.readAsBytes();
  print('The file is ${contents.length} bytes long.');
}</pre>

<h3 id="handling-errors">
<a id="handling-errors" class="anchor" href="#handling-errors" aria-hidden="true"><span class="octicon octicon-link"></span></a>Handling errors</h3>

<p>To capture errors so they don’t result in uncaught exceptions, you can
register a <code class="highlighter-rouge">catchError</code> handler on the Future,
or (in an async function) use try-catch:</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (try-catch)" replace="/does-not-exist/config/g"?>
<pre class="prettyprint lang-dart">Future main() async {
  var config = File('config.txt');
  try {
    var contents = await config.readAsString();
    print(contents);
  } catch (e) {
    print(e);
  }
}</pre>

<h3 id="streaming-file-contents">
<a id="streaming-file-contents" class="anchor" href="#streaming-file-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Streaming file contents</h3>

<p>Use a Stream to read a file, a little at a time.
You can use either the <a href="/guides/libraries/library-tour#stream">Stream API</a>
or <code class="highlighter-rouge">await for</code>, part of Dart’s
<a href="/guides/language/language-tour#asynchrony-support">asynchrony support.</a></p>

<?code-excerpt "misc/test/library_tour/io_test.dart (read-from-stream)" replace="/_?test_\w*\/?//g"?>
<pre class="prettyprint lang-dart">import 'dart:async';
import 'dart:io';
import 'dart:convert';

Future main() async {
  var config = File('config.txt');
  Stream&lt;List&lt;int&gt;&gt; inputStream = config.openRead();

  var lines = inputStream
      .transform(utf8.decoder)
      .transform(LineSplitter());
  try {
    await for (var line in lines) {
      print('Got ${line.length} characters from stream');
    }
    print('file is now closed');
  } catch (e) {
    print(e);
  }
}</pre>

<h3 id="writing-file-contents">
<a id="writing-file-contents" class="anchor" href="#writing-file-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing file contents</h3>

<p>You can use an <a href="https://api.dartlang.org/stable/dart-io/IOSink-class.html">IOSink</a> to
write data to a file. Use the File <code class="highlighter-rouge">openWrite()</code> method to get an IOSink
that you can write to. The default mode, <code class="highlighter-rouge">FileMode.write</code>, completely
overwrites existing data in the file.</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (write-file)" replace="/\btest_data\///g"?>
<pre class="prettyprint lang-dart">var logFile = File('log.txt');
var sink = logFile.openWrite();
sink.write('FILE ACCESSED ${DateTime.now()}\n');
await sink.flush();
await sink.close();</pre>

<p>To add to the end of the file, use the optional <code class="highlighter-rouge">mode</code> parameter to
specify <code class="highlighter-rouge">FileMode.append</code>:</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (append)" replace="/_?test_\w*\/?//g"?>
<pre class="prettyprint lang-dart">var sink = logFile.openWrite(mode: FileMode.append);</pre>

<p>To write binary data, use <code class="highlighter-rouge">add(List&lt;int&gt; data)</code>.</p>

<h3 id="listing-files-in-a-directory">
<a id="listing-files-in-a-directory" class="anchor" href="#listing-files-in-a-directory" aria-hidden="true"><span class="octicon octicon-link"></span></a>Listing files in a directory</h3>

<p>Finding all files and subdirectories for a directory is an asynchronous
operation. The <code class="highlighter-rouge">list()</code> method returns a Stream that emits an object
when a file or directory is encountered.</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (list-dir)" replace="/\btest_data\b/tmp/g"?>
<pre class="prettyprint lang-dart">Future main() async {
  var dir = Directory('tmp');

  try {
    var dirList = dir.list();
    await for (FileSystemEntity f in dirList) {
      if (f is File) {
        print('Found file ${f.path}');
      } else if (f is Directory) {
        print('Found dir ${f.path}');
      }
    }
  } catch (e) {
    print(e.toString());
  }
}</pre>

<h3 id="other-common-functionality">
<a id="other-common-functionality" class="anchor" href="#other-common-functionality" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other common functionality</h3>

<p>The File and Directory classes contain other functionality, including
but not limited to:</p>

<ul>
  <li>Creating a file or directory: <code class="highlighter-rouge">create()</code> in File and Directory</li>
  <li>Deleting a file or directory: <code class="highlighter-rouge">delete()</code> in File and Directory</li>
  <li>Getting the length of a file: <code class="highlighter-rouge">length()</code> in File</li>
  <li>Getting random access to a file: <code class="highlighter-rouge">open()</code> in File</li>
</ul>

<p>Refer to the API docs for <a href="https://api.dartlang.org/stable/dart-io/File-class.html">File</a> and <a href="https://api.dartlang.org/stable/dart-io/Directory-class.html">Directory</a> for a full
list of methods.</p>

<h2 id="http-clients-and-servers">
<a id="http-clients-and-servers" class="anchor" href="#http-clients-and-servers" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTTP clients and servers</h2>

<p>The dart:io library provides classes that command-line apps can use for
accessing HTTP resources, as well as running HTTP servers.</p>

<h3 id="http-server">
<a id="http-server" class="anchor" href="#http-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTTP server</h3>

<p>The <a href="https://api.dartlang.org/stable/dart-io/HttpServer-class.html">HttpServer</a> class
provides the low-level functionality for building web servers. You can
match request handlers, set headers, stream data, and more.</p>

<p>The following sample web server returns simple text information.
This server listens on port 8888 and address 127.0.0.1 (localhost),
responding to requests for the path <code class="highlighter-rouge">/dart</code>. For any other path,
the response is status code 404 (page not found).</p>

<?code-excerpt "misc/lib/library_tour/io/http_server.dart" replace="/\b_//g"?>
<pre class="prettyprint lang-dart">Future main() async {
  final requests = await HttpServer.bind('localhost', 8888);
  await for (var request in requests) {
    processRequest(request);
  }
}

void processRequest(HttpRequest request) {
  print('Got request for ${request.uri.path}');
  final response = request.response;
  if (request.uri.path == '/dart') {
    response
      ..headers.contentType = ContentType(
        'text',
        'plain',
      )
      ..write('Hello from the server');
  } else {
    response.statusCode = HttpStatus.notFound;
  }
  response.close();
}</pre>

<h3 id="http-client">
<a id="http-client" class="anchor" href="#http-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTTP client</h3>

<p>The <a href="https://api.dartlang.org/stable/dart-io/HttpClient-class.html">HttpClient</a> class
helps you connect to HTTP resources from your Dart command-line or
server-side application. You can set headers, use HTTP methods, and read
and write data. The HttpClient class does not work in browser-based
apps. When programming in the browser, use the
<a href="https://api.dartlang.org/stable/dart-html/HttpRequest-class.html">dart:html HttpRequest class.</a>
Here’s an example of using HttpClient:</p>

<?code-excerpt "misc/test/library_tour/io_test.dart (client)"?>
<pre class="prettyprint lang-dart">Future main() async {
  var url = Uri.parse('http://localhost:8888/dart');
  var httpClient = HttpClient();
  var request = await httpClient.getUrl(url);
  var response = await request.close();
  var data = await response.transform(utf8.decoder).toList();
  print('Response ${response.statusCode}: $data');
  httpClient.close();
}</pre>

<h2 id="more-information">
<a id="more-information" class="anchor" href="#more-information" aria-hidden="true"><span class="octicon octicon-link"></span></a>More information</h2>

<p>This page showed how to use the major features of the <a href="https://api.dartlang.org/stable/dart-io/dart-io-library.html">dart:io</a> library.
Besides the APIs discussed in this section, the dart:io library also
provides APIs for <a href="https://api.dartlang.org/stable/dart-io/Process-class.html">processes,</a> <a href="https://api.dartlang.org/stable/dart-io/Socket-class.html">sockets,</a> and
<a href="https://api.dartlang.org/stable/dart-io/WebSocket-class.html">web sockets.</a>
To find more examples of using dart:io, go to the
<a href="https://github.com/dart-lang/dart-samples">dart-samples repo.</a>
For more information about server-side and command-line app development, see the
<a href="/dart-vm">server-side Dart overview.</a></p>

<p>For information on other dart:* libraries, see the
<a href="/guides/libraries/library-tour">library tour.</a></p>


          

        </div>
      </article>
    </main>
    <footer id="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-sm-12 col-md-3">
        <div class="content">
          <div class="brand">
            <img src="/assets/shared/dart/logo+text/horizontal/mono.svg" alt="Dart logo" class="brand"/>
          </div>
          <h4><a href="/terms">Terms</a> | <a href="https://policies.google.com/privacy">Privacy</a></h4>
          <style>.menu .material-icons { font-size: 14px; }</style><ul class="menu">
            <li>Site&nbsp;<a href="http://creativecommons.org/licenses/by/3.0/" class="no-automatic-external">CC&nbsp;BY&nbsp;3.0</a></li>
            <li>
              <a href="https://github.com/dart-lang/site-www"
                 title="This site's source is on GitHub."
                 class="no-automatic-external"><i class="fab fa-github fa-sm"></i></a>
              &nbsp;
              <a href="https://github.com/dart-lang/site-www/issues"
                 title="File an issue about this site."
                 class="no-automatic-external"><i class="fas fa-bug fa-sm"></i></a>
              &nbsp;
              <a 
                 title="Site built on 2018/08/18 12:44 CST"
                 
                 class="no-automatic-external"><i class="material-icons">build</i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-sm-4 col-md-3">
        <div class="content">
          <h4>技术</h4>
          <ul>
            <li><a href="https://flutter.io">Dart 移动开发 (Flutter)</a></li>
            <li><a href="https://webdev.dartlang.org">Dart web 开发</a></li>
            <li><a href="/dart-vm">Dart 服务器开发</a></li>
            <li><a href="https://dart-lang.github.io/observatory/">Observatory 工具</a></li>
            <li><a href="/guides/libraries">Dart 库</a></li>
            <li><a href="/guides/language">Dart 编程语言</a></li>
          </ul>
        </div>
      </div>

      <div class="col-sm-4 col-md-3">
        <div class="content">
          <h4>资源</h4>
          <ul>
            <li><a href="https://api.dartlang.org/stable">API 参考</a></li>
            <li><a href="https://dartpad.dartlang.org/">DartPad</a></li>
            <li><a href="https://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://news.dartlang.org/">Dart 新闻</a></li>
            <li><a href="https://github.com/dart-lang/sdk/issues">Dart bugs 和 <br> 新需求</a></li>
          </ul>
        </div>
      </div>

      <div class="col-sm-4 col-md-3">
        <div class="content">
          <h4>社区</h4>
          <ul>
            <li><a href="/community">支持和邮件列表</a></li>
            <li><a href="/community/who-uses-dart">谁在用Dart</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
            <li>G+ <a href="https://plus.google.com/communities/114566943291919232850">社区</a> &
                <a href="https://plus.google.com/b/109866369054280216564/+dartlang">公告组</a></li>
            <li><a href="https://gitter.im/dart-lang/home">Gitter聊天室</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

  </body>
</html>
