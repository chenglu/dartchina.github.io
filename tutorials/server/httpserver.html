<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="en_US" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Communicate over the internet">
  <title>Write HTTP Clients & Servers | Dart</title>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/touch-icon-iphone-a46c306c4fbfae0b28d63f512b01d7cb2ccf1e4ca9d7f3aab15ba1170beed4a0.png" rel="apple-touch-icon">
  <link href="/assets/touch-icon-ipad-d0181720760b3912858b6d40da1d5586b1e92c7c8656a485ea41005674401e6b.png" rel="apple-touch-icon" sizes="76x76">
  <link href="/assets/touch-icon-iphone-retina-3d9821a631425376ac6203dea3c23c1940ab7b5c506a25406662fab76cee2e0b.png" rel="apple-touch-icon" sizes="120x120">
  <link href="/assets/touch-icon-ipad-retina-b9715401952522f1daee2b4a4064a1bbfb5ffab78d0a47a7226dc87444d51c32.png" rel="apple-touch-icon" sizes="152x152">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@dart_lang" />
  <meta name="twitter:title" content="Write HTTP Clients & Servers" />
  <meta name="twitter:description" content="Communicate over the internet" />

  <!-- Open Graph -->
  <meta property="og:title" content="Write HTTP Clients & Servers" />
  <meta property="og:description" content="Communicate over the internet" />
  <meta property="og:url" content="https://www.dartlang.org/tutorials/server/httpserver" />
  <meta property="og:image" content="https://www.dartlang.org/assets/shared/dart-logo-for-shares.png?2" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" integrity="sha256-EULh7n7c0RZiOHiikIAEzXBQ0AXvb71Ul6a85V4AuTc=" crossorigin="anonymous" href="/assets/main-1142e1ee7edcd116623878a2908004cd7050d005ef6fbd5497a6bce55e00b937.css">
  <script src="/assets/main-8306ad9c5a7b0d639cab54fda750f6ae0b3fb8f964457c69a7ef962a0cc52902.js" integrity="sha256-gwatnFp7DWOcq1T9p1D2rgs/uPlkRXxpp++WKgzFKQI=" crossorigin="anonymous" type="text/javascript"></script>
  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26406144-4', 'auto');
ga('send', 'pageview');

</script>


</head>

  <body class="tutorial">
    <header id="page-header">
  <nav id="mainnav">
  <div id="menu-toggle"><i class="icon icon-menu"></i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/shared/dart/logo+text/horizontal/default-363c9c133ffb7780463d3d638632b64cc8221d74d93cd1002fb1efbbe9983bc9.svg" alt="Dart">
  </a>
  <ul>
    <li class="mainnav__get-started"><a href="/guides/get-started"><span>入门</span></a></li>
    <li><a href="/guides/language">语言</a></li>
    <li><a href="/guides/libraries">库</a></li>
    <li><a href="/tools">工具</a></li>
    
    
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dart 2</a>
      <ul class="dropdown-menu">
        

<li><a href="https://v1-dartlang-org.firebaseapp.com/tutorials/server/httpserver" class="dropdown-item no-automatic-external">1.24.3&nbsp;&nbsp;(archive)</a></li><li><a class="active dropdown-item">2.1.0&nbsp;&nbsp;(stable)</a></li>

        <li role="separator" class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="/dart-2#migration">迁移指南</a></li>
      </ul>
    </li>
    
    <li class="searchfield">
      <form class="navbar-search" action="/search" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input type="search" name="q" id="q" autocomplete="off" placeholder="Search">
        <button type="submit"><i class="icon icon-search"></i></button>
      </form>
    </li>
  </ul>
</nav>

  
</header>

    <main id="page-content">
      <div id="sidenav" class="">
  <div class="content">
    <a href="/" class="brand" title="Dart">
      <img src="/assets/shared/dart/logo+text/horizontal/default-363c9c133ffb7780463d3d638632b64cc8221d74d93cd1002fb1efbbe9983bc9.svg" alt="Dart">
    </a>

    <div class="sidenav__search">
      <p>
        <a href="/search">Search <i class="icon icon-search"></i></a>
      </p>
    </div>

    <ul>
      <li>
        <a class="btn btn-light" href="/guides/get-started">入门</a>
      </li>
    </ul>
    <h4 ><a href="/guides/language" title="语言">语言</a></h4>
  <ul><li >
          <a href="/guides/language/language-tour" title="概览">概览</a>
        </li>
        
        <li >
          <a href="/guides/language/effective-dart" title="Effective Dart">Effective Dart</a>
          <i class="icon icon-arrow"></i>
          <ul><li >
                <a href="/guides/language/effective-dart/style" title="风格">风格</a>
              </li><li >
                <a href="/guides/language/effective-dart/documentation" title="文档">文档</a>
              </li><li >
                <a href="/guides/language/effective-dart/usage" title="使用">使用</a>
              </li><li >
                <a href="/guides/language/effective-dart/design" title="设计">设计</a>
              </li>
          </ul><li >
          <a href="/samples" title="示例代码">示例代码</a>
        </li>
  </ul><h4 ><a href="/guides/libraries" title="库">库</a></h4>
  <ul><li >
          <a href="/guides/libraries/library-tour" title="概览">概览</a>
        </li>
  </ul><h4 ><a href="/guides/platforms" title="平台">平台</a></h4>
  <ul><li >
          <a href="https://flutterchina.club" title="移动端 (Flutter中文网)">移动端 (Flutter中文网)</a>
        </li><li >
          <a href="https://webdev.dartlang.org" title="Web">Web</a>
        </li><li >
          <a href="/server" title="服务器">服务器</a>
        </li>
  </ul><h4 ><a href="/guides/testing" title="测试">测试</a></h4>
  <ul>
  </ul><h4 >资源</h4>
  <ul><li >
          <a href="/install" title="安装">安装</a>
        </li><li >
          <a href="/codelabs" title="Codelab">Codelab</a>
        </li><li class="active">
          <a href="/tutorials" title="学习指南">学习指南</a>
        </li><li >
          <a href="/tools" title="工具">工具</a>
        </li><li >
          <a href="/community" title="社区支持">社区支持</a>
        </li>
  </ul>
  </div>
</div>

      
<div id="toc">
  <div class="content">
    <header class="h4 text-uppercase">
      目录
      <a title="Back to top" class="back-to-top float-right mr-3">
        <i class="fas fa-angle-up"></i>
      </a>
    </header>
    <ul class="section-nav">
<li class="toc-entry toc-h3"><a href="#communicate-over-the-internet">Communicate over the internet</a></li>
<li class="toc-entry toc-h2"><a href="#get-the-source-code">Get the source code</a></li>
<li class="toc-entry toc-h2"><a href="#run-hello-world">Run the hello world server</a>
<ul>
<li class="toc-entry toc-h3"><a href="#a-quick-glance-at-the-code">A quick glance at the code</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#binding">Binding a server to a host and port</a>
<ul>
<li class="toc-entry toc-h3"><a href="#hostname">Hostname</a></li>
<li class="toc-entry toc-h3"><a href="#port">Port</a></li>
<li class="toc-entry toc-h3"><a href="#listening-for-requests">Listening for requests</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#using-forms-to-make-get-requests">Using HTML forms to make GET requests</a>
<ul>
<li class="toc-entry toc-h3"><a href="#a-restful-get-request">A RESTful GET request</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#httprequest-object">Listening for and handling requests</a>
<ul>
<li class="toc-entry toc-h3"><a href="#using-the-method-property">Using the method property</a></li>
<li class="toc-entry toc-h3"><a href="#using-the-uri-property">Using the uri property</a></li>
<li class="toc-entry toc-h3"><a href="#setting-the-status-code-for-the-response">Setting the status code for the response</a></li>
<li class="toc-entry toc-h3"><a href="#writing-the-response-to-the-httpresponse-object">Writing the response to the HttpResponse object</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#making-post">Making a POST request from a standalone client</a>
<ul>
<li class="toc-entry toc-h3"><a href="#a-restful-post-request">A RESTful POST request</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#handling-post">Handling a POST request in a server</a></li>
<li class="toc-entry toc-h2"><a href="#using-http-server-package">Using the http_server package</a></li>
<li class="toc-entry toc-h2"><a href="#using-https">Using https with bindSecure()</a></li>
<li class="toc-entry toc-h2"><a href="#other-resources">Other resources</a></li>
<li class="toc-entry toc-h2"><a href="#what-next">What next?</a></li>
</ul>
  </div>
</div>


      <article>
        <div class="content">
           <div class="banner alert alert-info">
  <p class="banner__text">
    
    
    Dart 2.1 现发布，具有更高的性能和可用性。
    <a href="https://medium.com/dartlang/announcing-dart-2-1-improved-performance-usability-9f55fca6f31a">了解更多。</a>
  </p>
</div>
 
          
<nav id="subnav">
  <ul>
    <li class="previous">
      
        <a href="/tutorials/server/cmdline">&lang;&nbsp;&nbsp;Write Command-Line Apps</a>
      
    </li>
    <li class="next">
      
    </li>
  </ul>
</nav>


          <div>
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/dartchina/site-www-cn/tree/src_zh_CN/src_zh_CN/_tutorials/server/httpserver.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="fas fa-file-alt fa-sm"></i>
  </a>
  <a href="https://github.com/dartchina/site-www-cn/issues/new?title='Write HTTP Clients & Servers' page issue&body=
Page URL: https://www.dartlang.org/tutorials/server/httpserver%0D%0A
Page source: https://github.com/dartchina/site-www-cn/tree/src_zh_CN/src_zh_CN/_tutorials/server/httpserver.md%0D%0A
%0D%0A
<!-- ADD YOUR DESCRIPTION OF THE PAGE ISSUE HERE: -->" class="btn no-automatic-external" title="Report a issue with this page"
    target="_blank" rel="noopener">
    <i class="fas fa-bug fa-sm"></i>
  </a>
</div>

            <h1>Write HTTP Clients & Servers</h1>
          </div>
          
<h3 id="communicate-over-the-internet">
<a id="communicate-over-the-internet" class="anchor" href="#communicate-over-the-internet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Communicate over the internet</h3>

<div class="mini-toc">
  <h4>What's the point?</h4>

  <ul>
    <li>Knowledge of Futures and Streams is a prerequisite.</li>
    <li>The HTTP protocol allows clients and servers to communicate.</li>
    <li>The dart:io package has classes for writing HTTP programs.</li>
    <li>Servers listen for requests on a host and port.</li>
    <li>Clients send requests using an HTTP method request.</li>
    <li>The http_server package provides higher-level building blocks.</li>
  </ul>
</div>

<aside class="alert alert-info">
  <p><strong>Prerequisite:</strong> HTTP servers and clients rely heavily on
  <a href="https://api.dartlang.org/stable/dart-async/Future-class.html">Futures</a> and <a href="https://api.dartlang.org/stable/dart-async/Stream-class.html">Streams</a>, which are not explained in this
  tutorial. Refer to
  <a href="/tutorials/language/futures">Asynchronous Programming: Futures</a> and
  <a href="/tutorials/language/streams">Asynchronous Programming: Streams</a>
  for information about using these classes.</p>
</aside>

<p>HTTP (Hypertext Transfer Protocol) is a communication protocol used
to send data from one program to another over the internet.
At one end of the data transfer is a server
and at the other end is a client.
The client is often browser-based
(either a user typing in a browser or a script running in a browser),
but might also be a standalone program.</p>

<p>The server <em>binds</em> to a host and port (it
makes an exclusive connection to an IP address and
a port number).
Then the server listens for requests.
Because of Dart’s asynchronous nature,
the server can handle many requests at a single time,
as follows:</p>

<ul>
  <li>Server listens</li>
  <li>Client connects</li>
  <li>Server accepts and receives request (and continues to listen)</li>
  <li>Server can continue to accept other requests</li>
  <li>Server writes response of request or several, possibly interleaved, requests</li>
  <li>Server finally ends (closes) the response(s).</li>
</ul>

<p>In Dart, the <a href="https://api.dartlang.org/stable/dart-io/dart-io-library.html">dart:io</a> library contains
the classes and functions you need to write HTTP
clients and servers. In addition, the <a href="https://pub.dartlang.org/packages/http_server">http_server</a> package
contains some higher-level classes that make it easier to write
clients and servers.</p>

<aside class="alert alert-info">
  <p><strong>Important:</strong> <em>Browser-based programs <strong>cannot</strong> use the
  dart:io library.</em></p>

  <p>The APIs in the dart:io library
  work <em>only</em> with standalone, command-line programs.
  They do not work in the browser.
  To make HTTP requests from a browser-based client
  refer to the <a href="https://api.dartlang.org/stable/dart-html/HttpRequest-class.html">dart:html HttpRequest</a> class.</p>
</aside>

<p>This tutorial provides several examples that show how easy
it is to write Dart HTTP servers and clients.
Beginning with the hello world of servers,
you learn how to write the code for a server
from binding and listening to responding to requests.
You also learn about the client side: making different
kinds of requests (GET and POST),
writing browser-based and command-line clients.</p>

<h2 id="get-the-source-code">
<a id="get-the-source-code" class="anchor" href="#get-the-source-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>Get the source code</h2>

<ul>
  <li>Get the Dart Tutorials <a href="https://github.com/dart-lang/dart-tutorials-samples/archive/master.zip">example code.</a>
</li>
  <li>View the <code class="highlighter-rouge">httpserver</code> directory, which contains the sources you need for this
tutorial.</li>
</ul>

<h2 id="run-hello-world">
<a id="run-hello-world" class="anchor" href="#run-hello-world" aria-hidden="true"><span class="octicon octicon-link"></span></a>Run the hello world server</h2>

<p><em>Example file for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/hello_world_server.dart">hello_world_server.dart.</a></p>

<p>Let’s begin with a small server that responds to all requests
with the string <code class="highlighter-rouge">Hello, world!</code></p>

<p>At the command line, run the <code class="highlighter-rouge">hello_world_server.dart</code> script:</p>

<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>httpserver/bin
<span class="gp">$</span> dart hello_world_server.dart
<span class="go">listening on localhost, port 4040
</span></code></pre></div></div>

<p><i class="material-icons">open_in_browser</i>
<strong>In any browser, visit</strong> <a href="http://localhost:4040">localhost:4040</a>.
The browser displays <code class="highlighter-rouge">Hello, world!</code></p>

<p><img src="/tutorials/server/images/hello_world_response.png" alt="The response from the hello world server."></p>

<p>In this case, the server is a Dart program
and the client is the browser you used.
However, you can write client programs in Dart—either
a browser-based client script, or a standalone program.</p>

<h3 id="a-quick-glance-at-the-code">
<a id="a-quick-glance-at-the-code" class="anchor" href="#a-quick-glance-at-the-code" aria-hidden="true"><span class="octicon octicon-link"></span></a>A quick glance at the code</h3>

<p>In the code for the hello world server,
an HTTP server binds to a host and port,
listens for HTTP requests, and writes a response.
Note that the program imports
the <a href="https://api.dartlang.org/stable/dart-io/dart-io-library.html">dart:io</a> library, which contains the HTTP-related
classes both for server-side programs and for
client-side programs (but not for web apps).</p>

<?code-excerpt "httpserver/bin/hello_world_server.dart" replace="/.*?dart:io.*/[!$&!]/g"?>
<pre class="prettyprint lang-dart"><span class="highlight">import 'dart:io';</span>

Future main() async {
  var server = await HttpServer.bind(
    InternetAddress.loopbackIPv4,
    4040,
  );
  print('Listening on localhost:${server.port}');

  await for (HttpRequest request in server) {
    request.response
      ..write('Hello, world!')
      ..close();
  }
}</pre>
<div class="prettify-filename">hello_world_server.dart</div>

<p>The next few sections cover server-side binding,
making a client-side GET request,
listening, and responding.</p>

<h2 id="binding">
<a id="binding" class="anchor" href="#binding" aria-hidden="true"><span class="octicon octicon-link"></span></a>Binding a server to a host and port</h2>

<p><em>Example for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/hello_world_server.dart">hello_world_server.dart.</a></p>

<p>The first statement in <code class="highlighter-rouge">main()</code> uses <code class="highlighter-rouge">HttpServer.bind()</code> to create an
<a href="https://api.dartlang.org/stable/dart-io/HttpServer-class.html">HttpServer</a> object and bind it to a host and port.</p>

<?code-excerpt "httpserver/bin/hello_world_server.dart (bind)"?>
<pre class="prettyprint lang-dart">var server = await HttpServer.bind(
  InternetAddress.loopbackIPv4,
  4040,
);</pre>
<div class="prettify-filename">hello_world_server.dart</div>

<p>The code uses <code class="highlighter-rouge">await</code> to call the <code class="highlighter-rouge">bind</code> method asynchronously.</p>

<h3 id="hostname">
<a id="hostname" class="anchor" href="#hostname" aria-hidden="true"><span class="octicon octicon-link"></span></a>Hostname</h3>
<p>The first parameter of <code class="highlighter-rouge">bind()</code> specifies the hostname.
You can specify a particular hostname or IP address as a String.
Alternatively, you can specify the host using these predefined values
provided by the <a href="https://api.dartlang.org/stable/dart-io/InternetAddress-class.html">InternetAddress</a> class:</p>

<table class="table">
  <thead>
    <tr>
      <th>Value</th>
      <th>Use case</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>loopbackIPv4<br><em>or</em><br>loopbackIPv6</td>
      <td>The server listens for client activity on the loopback address, which is effectively localhost. Uses either version 4 or 6 of the IP protocol. These are used primarily for testing. We recommend that you use these values instead of <code class="highlighter-rouge">localhost</code> or <code class="highlighter-rouge">127.0.0.1</code>.</td>
    </tr>
    <tr>
      <td>anyIPv4<br><em>or</em><br>anyIPv6</td>
      <td>The server listens for client activity on the specified port on any IP address. Uses either version 4 or 6 of the IP protocol.</td>
    </tr>
  </tbody>
</table>

<p>By default, when using a V6 internet address,
a V4 listener is used as well.</p>

<h3 id="port">
<a id="port" class="anchor" href="#port" aria-hidden="true"><span class="octicon octicon-link"></span></a>Port</h3>

<p>The second parameter to <code class="highlighter-rouge">bind()</code> is an integer
that specifies the port.
The port uniquely identifies a service on the host computer.
Port numbers below 1024 are reserved (except for 0)
for standard services.
For example, FTP data transfer typically runs on port 20,
quote of the day on port 17, and HTTP on port 80.
Your program should use port numbers from 1024 and higher.
If the port is already in use,
the connection for your server will be refused.</p>

<h3 id="listening-for-requests">
<a id="listening-for-requests" class="anchor" href="#listening-for-requests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Listening for requests</h3>

<p>The server begins listening for HTTP requests using <code class="highlighter-rouge">await for</code>.
For each request received, the code sends a “Hello, world!” response.</p>

<?code-excerpt "httpserver/bin/hello_world_server.dart (listen)"?>
<pre class="prettyprint lang-dart">await for (HttpRequest request in server) {
  request.response
    ..write('Hello, world!')
    ..close();
}</pre>
<div class="prettify-filename">hello_world_server.dart</div>

<p>You’ll learn more about what the <a href="https://api.dartlang.org/stable/dart-io/HttpRequest-class.html">HttpRequest</a> object contains
and how to write the response in the section
<a href="#httprequest-object">Listening for and handling requests</a>.
But first, let’s look at one way a client generates a request.</p>

<h2 id="using-forms-to-make-get-requests">
<a id="using-forms-to-make-get-requests" class="anchor" href="#using-forms-to-make-get-requests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using HTML forms to make GET requests</h2>

<p><em>Example files for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/number_thinker.dart">number_thinker.dart</a> and
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/web/make_a_guess.html">make_a_guess.html.</a></p>

<p>This section features a command-line server that
randomly chooses a number between 0 and 9.
The client is a basic HTML web-page, <code class="highlighter-rouge">make_a_guess.html</code>,
that you can use to guess the number.</p>

<hr>

<p><strong>Try it!</strong></p>

<ol>
  <li>
    <p><strong>Run the number thinker server</strong></p>

    <p>At the command line, run the <code class="highlighter-rouge">number_thinker.dart</code> server.
You should see something similar to the following:</p>

    <div class="language-terminal highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>httpserver/bin
<span class="gp">$</span> dart number_thinker.dart
<span class="go">I'm thinking of a number: 6
</span></code></pre></div>    </div>
  </li>
  <li>
    <p><strong>Launch the web server</strong></p>

    <p>Run <code class="highlighter-rouge">webdev serve</code> from the top directory of the app.</p>
  </li>
  <li>
    <p><strong>Open the HTML page</strong></p>

    <p>In a browser, go to
<a href="http://localhost:8080/make_a_guess.html">localhost:8080/make_a_guess.html</a>.</p>
  </li>
  <li>
    <p><strong>Make a guess</strong></p>

    <p>Choose a number and press the <strong>Guess</strong> button.</p>

    <p><img src="/tutorials/server/images/guessing.png" alt="The user makes a guess using a pull-down menu."></p>
  </li>
</ol>

<hr>

<p>No Dart code is involved in the client.
The client request is made from the browser
to the Dart server through an HTML form
within make_a_guess.html,
which provides an automatic way to formulate and send client HTTP requests.
The form contains the pull-down list and the button.
The form also specifies the URL, which includes the port number,
and the kind of request (the <em>request method</em>).
It might also include elements that build a query string.</p>

<p>Here’s the form HTML from <code class="highlighter-rouge">make_a_guess.html</code>:</p>

<?code-excerpt "httpserver/web/make_a_guess.html (form)" replace="/(action|method|name|type)=(.).*?\2/[!$&!]/g"?>
<pre class="prettyprint lang-html">&lt;form <span class="highlight">action="http://localhost:4041"</span> <span class="highlight">method="GET"</span>&gt;
  &lt;select <span class="highlight">name="q"</span>&gt;
    &lt;option value="0"&gt;0&lt;/option&gt;
    &lt;option value="1"&gt;1&lt;/option&gt;
    &lt;option value="2"&gt;2&lt;/option&gt;
    &lt;!-- ··· --&gt;
    &lt;option value="9"&gt;9&lt;/option&gt;
  &lt;/select&gt;
  &lt;input <span class="highlight">type="submit"</span> value="Guess"&gt;
&lt;/form&gt;</pre>
<div class="prettify-filename">make_a_guess.html</div>

<p>Here’s how the form works:</p>

<ul>
  <li>The form’s <code class="highlighter-rouge">action</code> attribute is assigned the
URL to send the request to.</li>
  <li>The form’s <code class="highlighter-rouge">method</code> attribute defines
the kind of request, here a <code class="highlighter-rouge">GET</code>. Other common
kinds of request include POST, PUT, and DELETE.</li>
  <li>Any element within the form that has a <code class="highlighter-rouge">name</code>, like the <code class="highlighter-rouge">&lt;select&gt;</code> element,
becomes a parameter in the query string.</li>
  <li>When pressed, the submit button (<code class="highlighter-rouge">&lt;input type="submit"...&gt;</code>) formulates
the request based on the content of the form and sends it.</li>
</ul>

<h3 id="a-restful-get-request">
<a id="a-restful-get-request" class="anchor" href="#a-restful-get-request" aria-hidden="true"><span class="octicon octicon-link"></span></a>A RESTful GET request</h3>

<p>REST (REpresentational State Transfer) is a set of principles
for designing Web services.
Well-behaved HTTP clients and servers observe the REST principles
defined for GET requests.</p>

<p>A GET request:</p>

<ul>
  <li>only retrieves data</li>
  <li>doesn’t change the state of the server</li>
  <li>has length limits</li>
  <li>can send query strings in the URL of the request</li>
</ul>

<p>The client in this example makes a REST-compliant GET request.</p>

<h2 id="httprequest-object">
<a id="httprequest-object" class="anchor" href="#httprequest-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Listening for and handling requests</h2>

<p><em>Example files for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/number_thinker.dart">number_thinker.dart</a> and
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/web/make_a_guess.html">make_a_guess.html.</a></p>

<p>Now that you’ve seen the browser-based client for this example,
let’s take a look at the Dart code for the number thinker server,
starting with <code class="highlighter-rouge">main()</code>.</p>

<p>Once again the server binds to a host and port.
Here, the top-level <code class="highlighter-rouge">handleRequest()</code> method is called for each
request received. Because HttpServer implements <a href="https://api.dartlang.org/stable/dart-async/Stream-class.html">Stream,</a>
you can use <code class="highlighter-rouge">await for</code> to process the requests.</p>

<?code-excerpt "httpserver/bin/number_thinker.dart (main)" replace="/handleRequest/[!$&!]/g"?>
<pre class="prettyprint lang-dart">import 'dart:io';
import 'dart:math' show Random;

Random intGenerator = Random();
int myNumber = intGenerator.nextInt(10);

Future main() async {
  print("I'm thinking of a number: $myNumber");

  HttpServer server = await HttpServer.bind(
    InternetAddress.loopbackIPv4,
    4041,
  );
  await for (var request in server) {
    <span class="highlight">handleRequest</span>(request);
  }
}</pre>
<div class="prettify-filename">number_thinker.dart</div>

<p>When a <code class="highlighter-rouge">GET</code> request arrives, the <code class="highlighter-rouge">handleRequest()</code> method calls
<code class="highlighter-rouge">handleGet()</code> to process the request.</p>

<?code-excerpt "httpserver/bin/number_thinker.dart (handleRequest)" replace="/handleGet/[!$&!]/g"?>
<pre class="prettyprint lang-dart">void handleRequest(HttpRequest request) {
  try {
    if (request.method == 'GET') {
      <span class="highlight">handleGet</span>(request);
    } else {
      // ···
    }
  } catch (e) {
    print('Exception in handleRequest: $e');
  }
  print('Request handled.');
}</pre>
<div class="prettify-filename">number_thinker.dart</div>

<p>An <a href="https://api.dartlang.org/stable/dart-io/HttpRequest-class.html">HttpRequest</a> object has many properties that provide
information about the request.
The following table lists some useful properties:</p>

<table class="table">
  <thead>
    <tr>
      <th>Property</th>
      <th>Information</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">method</code></td>
      <td>One of <code class="highlighter-rouge">'GET'</code>, <code class="highlighter-rouge">'POST'</code>, <code class="highlighter-rouge">'PUT'</code>, and so on.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">uri</code></td>
      <td>A  <a href="https://api.dartlang.org/stable/dart-core/Uri-class.html">Uri</a> object: scheme, host, port, query string, and other information about the requested resource.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">response</code></td>
      <td>An <a href="https://api.dartlang.org/stable/dart-io/HttpResponse-class.html">HttpResponse</a> object: where the server writes its response.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">headers</code></td>
      <td>An <a href="https://api.dartlang.org/stable/dart-io/HttpHeaders-class.html">HttpHeaders</a> object: the headers for the request, including <a href="https://api.dartlang.org/stable/dart-io/ContentType-class.html">ContentType,</a> content length, date, and so on.</td>
    </tr>
  </tbody>
</table>

<h3 id="using-the-method-property">
<a id="using-the-method-property" class="anchor" href="#using-the-method-property" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the method property</h3>

<p>The code below from the number thinker example uses the HttpRequest <code class="highlighter-rouge">method</code>
property to determine what kind of request has been received.
This server handles only GET requests.</p>

<?code-excerpt "httpserver/bin/number_thinker.dart (request-method)" replace="/handleGet/[!$&!]/g"?>
<pre class="prettyprint lang-dart">if (request.method == 'GET') {
  <span class="highlight">handleGet</span>(request);
} else {
  request.response
    ..statusCode = HttpStatus.methodNotAllowed
    ..write('Unsupported request: ${request.method}.')
    ..close();
}</pre>
<div class="prettify-filename">number_thinker.dart</div>

<h3 id="using-the-uri-property">
<a id="using-the-uri-property" class="anchor" href="#using-the-uri-property" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the uri property</h3>

<p>Typing a URL into a browser generates a GET request,
which simply requests data from the specified resource.
It can send a minimal amount of data along with the request
through a query string attached to the URI.</p>

<?code-excerpt "httpserver/bin/number_thinker.dart (uri)" replace="/request.uri/[!$&!]/g"?>
<pre class="prettyprint lang-dart">void handleGet(HttpRequest request) {
  final guess = <span class="highlight">request.uri</span>.queryParameters['q'];
  // ···
}</pre>
<div class="prettify-filename">number_thinker.dart</div>

<p>Use the <code class="highlighter-rouge">uri</code> property from the HttpRequest object to get a <a href="https://api.dartlang.org/stable/dart-core/Uri-class.html">Uri</a> object
that contains the information about the URL typed by the user.
The <code class="highlighter-rouge">queryParameters</code> property of the Uri object is a Map containing
the components of the query string.
Refer to the desired parameter by name.
This example uses <code class="highlighter-rouge">q</code> to identify the guessed number.</p>

<h3 id="setting-the-status-code-for-the-response">
<a id="setting-the-status-code-for-the-response" class="anchor" href="#setting-the-status-code-for-the-response" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting the status code for the response</h3>

<p>The server should set the status code to indicate the success or
failure of the request. Earlier you saw the number thinker set
the status code to <code class="highlighter-rouge">methodNotAllowed</code> to reject non-GET requests.
Later in the code,
to indicate that the request was successful and the response is complete,
the number thinker server sets the HttpResponse status code to <code class="highlighter-rouge">HttpStatus.ok</code>.</p>

<?code-excerpt "httpserver/bin/number_thinker.dart (statusCode)" replace="/response.statusCode.*?;/[!$&!]/g"?>
<pre class="prettyprint lang-dart">void handleGet(HttpRequest request) {
  final guess = request.uri.queryParameters['q'];
  final response = request.response;
  <span class="highlight">response.statusCode = HttpStatus.ok;</span>
  // ···
}</pre>
<div class="prettify-filename">number_thinker.dart</div>

<p><code class="highlighter-rouge">HttpStatus.ok</code> and <code class="highlighter-rouge">HttpStatus.methodNotAllowed</code> are
two of many predefined status codes in the <a href="https://api.dartlang.org/stable/dart-io/HttpStatus-class.html">HttpStatus</a> class.
Another useful predefined status code is
<code class="highlighter-rouge">HttpStatus.notFound</code> (your classic 404).</p>

<p>In addition to <code class="highlighter-rouge">statusCode</code>,
the HttpResponse object has other useful properties:</p>

<table class="table">
  <thead>
    <tr>
      <th>Property</th>
      <th>Information</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">contentLength</code></td>
      <td>The length of the response; -1 means the length is not known in advance.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">cookies</code></td>
      <td>A List of <a href="https://api.dartlang.org/stable/dart-io/Cookie-class.html">Cookies</a> to set in the client.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">encoding</code></td>
      <td>The <a href="https://api.dartlang.org/stable/dart-convert/Encoding-class.html">Encoding</a> used when writing strings, like JSON and UTF-8.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">headers</code></td>
      <td>The response headers, an <a href="https://api.dartlang.org/stable/dart-io/HttpHeaders-class.html">HttpHeaders</a> object.</td>
    </tr>
  </tbody>
</table>

<h3 id="writing-the-response-to-the-httpresponse-object">
<a id="writing-the-response-to-the-httpresponse-object" class="anchor" href="#writing-the-response-to-the-httpresponse-object" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing the response to the HttpResponse object</h3>

<p>Every HttpRequest object has a corresponding HttpResponse object.
The server sends data back to the client through the response object.</p>

<p>Use one of the HttpResponse write methods
(<code class="highlighter-rouge">write()</code>, <code class="highlighter-rouge">writeln()</code>, <code class="highlighter-rouge">writeAll()</code>, or <code class="highlighter-rouge">writeCharCodes()</code>)
to write the response data to the HttpResponse object.
Or connect the HttpResponse object to a stream via <code class="highlighter-rouge">addStream</code>
and write to the stream.
Close the object when the response is complete.
Closing the HttpResponse object
sends the data back to the client.</p>

<?code-excerpt "httpserver/bin/number_thinker.dart (write)" replace="/\.\..*/[!$&!]/g"?>
<pre class="prettyprint lang-dart">void handleGet(HttpRequest request) {
  // ···
  if (guess == myNumber.toString()) {
    response
      <span class="highlight">..writeln('true')</span>
      <span class="highlight">..writeln("I'm thinking of another number.")</span>
      <span class="highlight">..close();</span>
    // ···
  }
}</pre>
<div class="prettify-filename">number_thinker.dart</div>

<h2 id="making-post">
<a id="making-post" class="anchor" href="#making-post" aria-hidden="true"><span class="octicon octicon-link"></span></a>Making a POST request from a standalone client</h2>

<p><em>Example files for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/basic_writer_server.dart">basic_writer_server.dart</a> and
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/basic_writer_client.dart">basic_writer_client.dart.</a></p>

<p>In the hello world and number thinker examples,
the browser generated simple GET requests.
For more complex GET requests and other kinds of requests, such
as POST, PUT, or DELETE,
you need to write a client program, of which there are two kinds:</p>

<ul>
  <li>
    <p>A standalone client program, which uses the <a href="https://api.dartlang.org/stable/dart-io/HttpClient-class.html">HttpClient</a>
class from <code class="highlighter-rouge">dart:io</code>.</p>
  </li>
  <li>
    <p>A browser-based client, which uses API from <a href="https://api.dartlang.org/stable/dart-html/dart-html-library.html">dart:html.</a>
This tutorial does not cover browser-based clients.
To look at code for a browser-based client and
related server, see
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/web/note_client.dart">note_client.dart,</a>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/note_server.dart">note_server.dart,</a>
and <a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/web/note_taker.html">note_taker.html.</a></p>

    <p>Let’s look at a standalone client, <code class="highlighter-rouge">basic_writer_client.dart</code>,
and its server <code class="highlighter-rouge">basic_writer_server.dart</code>.
The client makes a POST request
to save JSON data to a server-side file.
The server accepts the request and saves the file.</p>
  </li>
</ul>

<hr>

<p><strong>Try it!</strong></p>

<p>Run the server and client on the command line.</p>

<ol>
  <li>
    <p>First, run the server:</p>

    <div class="language-terminal highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>httpserver/bin
<span class="gp">$</span> dart basic_writer_server.dart
</code></pre></div>    </div>
  </li>
  <li>
    <p>In a new terminal, run the client:</p>

    <div class="language-terminal highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>httpserver/bin
<span class="gp">$</span> dart basic_writer_client.dart
<span class="go">Wrote data for Han Solo.
</span></code></pre></div>    </div>
  </li>
</ol>

<p>Look at the JSON data that the server wrote to <code class="highlighter-rouge">file.txt</code>:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">   </span><span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="s2">"Han Solo"</span><span class="p">,</span><span class="s2">"job"</span><span class="p">:</span><span class="s2">"reluctant hero"</span><span class="p">,</span><span class="s2">"BFF"</span><span class="p">:</span><span class="s2">"Chewbacca"</span><span class="p">,</span><span class="s2">"ship"</span><span class="p">:</span><span class="s2">"Millennium Falcon"</span><span class="p">,</span><span class="s2">"weakness"</span><span class="p">:</span><span class="s2">"smuggling debts"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<hr>

<p>The client creates an HttpClient object and uses the
<code class="highlighter-rouge">post()</code> method to make the request.
Making a request involves two Futures:</p>

<ul>
  <li>
    <p>The <code class="highlighter-rouge">post()</code> method establishes a network
connection to the server and completes with the first Future,
which returns an HttpClientRequest object.</p>
  </li>
  <li>
    <p>The client composes the request object and closes it.
The <code class="highlighter-rouge">close()</code> method sends the request to the server
and returns the second Future, which completes with
an HttpClientResponse object.</p>
  </li>
</ul>

<?code-excerpt "httpserver/bin/basic_writer_client.dart" replace="/\/\*.\*\/|post|headers|write|close|utf8.\w+/[!$&!]/g"?>
<pre class="prettyprint lang-dart">import 'dart:io';
import 'dart:convert';

String _host = InternetAddress.loopbackIPv4.host;
String path = 'file.txt';

Map jsonData = {
  'name': 'Han Solo',
  'job': 'reluctant hero',
  'BFF': 'Chewbacca',
  'ship': 'Millennium Falcon',
  'weakness': 'smuggling debts'
};

Future main() async {
  HttpClientRequest request = await HttpClient().<span class="highlight">post</span>(_host, 4049, path) <span class="highlight">/*1*/</span>
    ..<span class="highlight">headers</span>.contentType = ContentType.json <span class="highlight">/*2*/</span>
    ..<span class="highlight">write</span>(jsonEncode(jsonData)); <span class="highlight">/*3*/</span>
  HttpClientResponse response = await request.<span class="highlight">close</span>(); <span class="highlight">/*4*/</span>
  await response.transform(<span class="highlight">utf8.decoder</span> <span class="highlight">/*5*/</span>).forEach(print);
}</pre>
<div class="prettify-filename">basic_writer_client.dart</div>

<ol class="code-notes">
  <li>
    <p>The <code class="highlighter-rouge">post()</code> method requires the host, port, and the path to the requested
resource. In addition to <code class="highlighter-rouge">post()</code>, the <a href="https://api.dartlang.org/stable/dart-io/HttpClient-class.html">HttpClient</a> class provides
functions for making other kinds of requests, including <code class="highlighter-rouge">postUrl()</code>,
<code class="highlighter-rouge">get()</code>, and <code class="highlighter-rouge">open()</code>.</p>
  </li>
  <li>
    <p>An <a href="https://api.dartlang.org/stable/dart-io/HttpClientRequest-class.html">HttpClientRequest</a> object has an <a href="https://api.dartlang.org/stable/dart-io/HttpHeaders-class.html">HttpHeaders</a> object, which
contains the request headers. For some headers, like <code class="highlighter-rouge">contentType</code>,
HttpHeaders has a property specific to that header. For other headers, use
the <code class="highlighter-rouge">set()</code> method to put the header in the HttpHeaders object.</p>
  </li>
  <li>
    <p>The client writes data to the request object using <code class="highlighter-rouge">write()</code>. The encoding,
JSON in this example, matches the type specified in the <a href="https://api.dartlang.org/stable/dart-io/ContentType-class.html">ContentType</a>
header.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">close()</code> method sends the request to the server and, when complete,
returns an <a href="https://api.dartlang.org/stable/dart-io/HttpClientResponse-class.html">HttpClientResponse</a> object.</p>
  </li>
  <li>
    <p>The UTF-8 response from the server is decoded. Use a transformer defined in
the <a href="https://api.dartlang.org/stable/dart-convert/dart-convert-library.html">dart:convert</a> library to convert the data into regular Dart string
format.</p>
  </li>
</ol>

<h3 id="a-restful-post-request">
<a id="a-restful-post-request" class="anchor" href="#a-restful-post-request" aria-hidden="true"><span class="octicon octicon-link"></span></a>A RESTful POST request</h3>

<p>Similar to GET requests, REST provides guidelines for POST requests.</p>

<p>A POST request:</p>

<ul>
  <li>creates a resource (in this example, a file)</li>
  <li>uses a URI that has a structure similiar to file and directory pathnames;
for example, the URI has no query string</li>
  <li>transfers data as JSON or XML</li>
  <li>has no state and does not change the state of the server</li>
  <li>has no length limits</li>
</ul>

<p>The client in this example makes REST-compliant POST requests.</p>

<p>To see client code that makes REST-compliant GET requests,
look at <a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/number_guesser.dart">number_guesser.dart.</a>
It’s a standalone client for the number thinker server
that makes periodic guesses until it guesses correctly.</p>

<h2 id="handling-post">
<a id="handling-post" class="anchor" href="#handling-post" aria-hidden="true"><span class="octicon octicon-link"></span></a>Handling a POST request in a server</h2>

<p><em>Example files for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/basic_writer_server.dart">basic_writer_server.dart</a> and
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/basic_writer_client.dart">basic_writer_client.dart.</a></p>

<p>An HttpRequest object is a stream of byte lists (<code class="highlighter-rouge">Stream&lt;List&lt;int&gt;&gt;</code>).
To get the data sent from the client,
listen for data on the HttpRequest object.</p>

<p>If the request from the client contains a large amount of
data, the data might arrive in multiple chunks. You can use the
join() method in Stream to concatenate the string values of those chunks.</p>

<p><img src="/tutorials/server/images/flowchart.png" alt="The flow of control in a server processing requests."></p>

<p>The <code class="highlighter-rouge">basic_writer_server.dart</code> file implements
a server that follows this pattern.</p>

<?code-excerpt "httpserver/bin/basic_writer_server.dart" replace="/\/\*\d\*\/|contentType.*? == \S+|(content|data) = [^;]*|req\.uri[^ ]*/[!$&!]/g"?>
<pre class="prettyprint lang-dart">import 'dart:io';
import 'dart:convert';

String _host = InternetAddress.loopbackIPv4.host;

Future main() async {
  var server = await HttpServer.bind(_host, 4049);
  await for (var req in server) {
    ContentType contentType = req.headers.contentType;
    HttpResponse response = req.response;

    if (req.method == 'POST' &amp;&amp;
        <span class="highlight">contentType?.mimeType == 'application/json'</span> <span class="highlight">/*1*/</span>) {
      try {
        String content =
            await req.transform(utf8.decoder).join(); <span class="highlight">/*2*/</span>
        var <span class="highlight">data = jsonDecode(content) as Map</span>; <span class="highlight">/*3*/</span>
        var fileName = <span class="highlight">req.uri.pathSegments.last;</span> <span class="highlight">/*4*/</span>
        await File(fileName)
            .writeAsString(content, mode: FileMode.write);
        req.response
          ..statusCode = HttpStatus.ok
          ..write('Wrote data for ${data['name']}.');
      } catch (e) {
        response
          ..statusCode = HttpStatus.internalServerError
          ..write("Exception during file I/O: $e.");
      }
    } else {
      response
        ..statusCode = HttpStatus.methodNotAllowed
        ..write("Unsupported request: ${req.method}.");
    }
    response.close();
  }
}</pre>
<div class="prettify-filename">basic_writer_server.dart</div>

<ol class="code-notes">
  <li>
    <p>The request has an HttpHeaders object. Recall that the client set the
<code class="highlighter-rouge">contentType</code> header to JSON (application/json). This server rejects
requests that are not JSON-encoded.</p>
  </li>
  <li>
    <p>A POST request has no limit on the amount of data it can send and the data
might be sent in multiple chunks. Furthermore, JSON is UTF-8, and UTF-8
characters can be encoded over multiple bytes. The join() method puts the
chunks together.</p>
  </li>
  <li>
    <p>The data sent by the client is JSON formatted. The server decodes it using
the JSON codec available in the <a href="https://api.dartlang.org/stable/dart-convert/dart-convert-library.html">dart:convert</a> library.</p>
  </li>
  <li>
    <p>The URL for the request is
<a href="http://localhost:4049/file.txt">localhost:4049/file.txt</a>. The code
<code class="highlighter-rouge">req.uri.pathSegments.last</code> extracts the file name from the URI:
<code class="highlighter-rouge">file.txt</code>.</p>
  </li>
</ol>

<h4 id="a-note-about-cors-headers">A note about CORS headers</h4>

<p>If you want to serve clients that are running on a different origin
(a different host or port), you need to add CORS headers.
The following code,
take from note_server.dart,
allows POST and OPTIONS requests from any origin.
Use CORS headers with caution,
because they can open your network up to security risks.</p>

<?code-excerpt "httpserver/bin/note_server.dart (addCorsHeaders)"?>
<pre class="prettyprint lang-dart">void addCorsHeaders(HttpResponse response) {
  response.headers.add('Access-Control-Allow-Origin', '*');
  response.headers
      .add('Access-Control-Allow-Methods', 'POST, OPTIONS');
  response.headers.add('Access-Control-Allow-Headers',
      'Origin, X-Requested-With, Content-Type, Accept');
}</pre>
<div class="prettify-filename">note_server.dart</div>

<p>For more information, refer to Wikipedia’s article
<a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">Cross-origin resource sharing</a>.</p>

<h2 id="using-http-server-package">
<a id="using-http-server-package" class="anchor" href="#using-http-server-package" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using the http_server package</h2>

<p><em>Example files for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/mini_file_server.dart">mini_file_server.dart</a> and
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/static_file_server.dart">static_file_server.dart.</a></p>

<p>For some higher-level building blocks,
we recommend that you try the
<a href="https://pub.dartlang.org/packages/http_server">http_server</a>
pub package,
which contains a set of classes that,
together with the HttpServer class in the <code class="highlighter-rouge">dart:io</code> library,
make it easier to implement HTTP servers.</p>

<p>In this section, we compare a server written
using API only from dart:io to a server
with the same functionality
written using dart:io together with http_server.</p>

<p>You can find the first server in <code class="highlighter-rouge">mini_file_server.dart</code>.
It responds to all requests by returning the contents of the
<code class="highlighter-rouge">index.html</code> file in the same directory as its source.</p>

<p><strong>Try it!</strong></p>

<ol>
  <li>
    <p>Run the server on the command line:</p>

    <div class="language-terminal highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>httpserver/bin
<span class="gp">$</span> dart mini_file_server.dart
</code></pre></div>    </div>
  </li>
  <li>
    <p>Type <a href="http://localhost:4044">localhost:4044</a> into the browser.
The server displays an HTML file:</p>

    <p><img src="/tutorials/server/images/index_file.png" alt="The index.html file served by mini_file_server.dart."></p>
  </li>
</ol>

<p>Here’s the code for mini file server:</p>

<?code-excerpt "httpserver/bin/mini_file_server.dart"?>
<pre class="prettyprint lang-dart">import 'dart:io';

File targetFile = File('index.html');

Future main() async {
  var server;

  try {
    server = await HttpServer.bind(InternetAddress.loopbackIPv4, 4044);
  } catch (e) {
    print("Couldn't bind to port 4044: $e");
    exit(-1);
  }

  await for (HttpRequest req in server) {
    if (await targetFile.exists()) {
      print("Serving ${targetFile.path}.");
      req.response.headers.contentType = ContentType.html;
      try {
        await targetFile.openRead().pipe(req.response);
      } catch (e) {
        print("Couldn't read file: $e");
        exit(-1);
      }
    } else {
      print("Can't open ${targetFile.path}.");
      req.response
        ..statusCode = HttpStatus.notFound
        ..close();
    }
  }
}</pre>
<div class="prettify-filename">mini_file_server.dart</div>

<p>This code determines whether the file exists,
and if it does, opens the file and pipes the contents
to the HttpResponse object.</p>

<p>The second server, whose code you can find in
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/basic_file_server.dart">basic_file_server.dart,</a>
uses the <a href="https://pub.dartlang.org/packages/http_server">http_server</a> package.</p>

<p><strong>Try it!</strong></p>

<ol>
  <li>
    <p>Run the server on the command line:</p>

    <div class="language-terminal highlighter-rouge">
<div class="highlight"><pre class="highlight"><code><span class="gp">$</span> <span class="nb">cd </span>httpserver/bin
<span class="gp">$</span> dart basic_file_server.dart
</code></pre></div>    </div>
  </li>
  <li>
    <p>Type <a href="http://localhost:4046">localhost:4046</a> into the browser.
The server displays the same index.html file as the previous:</p>

    <p><img src="/tutorials/server/images/index_file_4046.png" alt="The index.html file served by basic_file_server.dart."></p>
  </li>
</ol>

<p>In this server, the code for handling the request is much shorter,
because the <a href="https://www.dartdocs.org/documentation/http_server/latest/http_server/VirtualDirectory-class.html">VirtualDirectory</a> class handles the details of serving the file.</p>

<?code-excerpt "httpserver/bin/basic_file_server.dart" replace="/staticFiles\..*/[!$&!]/g"?>
<pre class="prettyprint lang-dart">import 'dart:io';
import 'package:http_server/http_server.dart';

File targetFile = File('index.html');

Future main() async {
  VirtualDirectory staticFiles = VirtualDirectory('.');

  var serverRequests =
      await HttpServer.bind(InternetAddress.loopbackIPv4, 4046);
  await for (var request in serverRequests) {
    <span class="highlight">staticFiles.serveFile(targetFile, request);</span>
  }
}</pre>
<div class="prettify-filename">basic_file_server.dart</div>

<p>Here, the requested resource, index.html, is served by
the <code class="highlighter-rouge">serveFile()</code> method in the VirtualDirectory class.
You don’t need to write code to open a file and pipe its contents
to the request.</p>

<p>Another file server, <code class="highlighter-rouge">static_file_server.dart</code>,
also uses the http_server package.
This server serves any file from the server’s directory
or subdirectory.</p>

<p>Run <code class="highlighter-rouge">static_file_server.dart</code>,
and test it with the URL localhost:4048/file.txt.
Change <code class="highlighter-rouge">file.txt</code> to other filenames within the directory.</p>

<p>Here is the code for <code class="highlighter-rouge">static_file_server.dart</code>.</p>

<?code-excerpt "httpserver/bin/static_file_server.dart" replace="/\/\*\d\*\//[!$&!]/g"?>
<pre class="prettyprint lang-dart">import 'dart:io';
import 'package:http_server/http_server.dart';
import 'package:path/path.dart';

Future main() async {
  var pathToBuild = join(dirname(Platform.script.toFilePath()));

  var staticFiles = VirtualDirectory(pathToBuild);
  staticFiles.allowDirectoryListing = true; <span class="highlight">/*1*/</span>
  staticFiles.directoryHandler = (dir, request) <span class="highlight">/*2*/</span> {
    var indexUri = Uri.file(dir.path).resolve('index.html');
    staticFiles.serveFile(File(indexUri.toFilePath()), request); <span class="highlight">/*3*/</span>
  };

  var server = await HttpServer.bind(InternetAddress.loopbackIPv4, 4048);
  print('Listening on port 4048');
  await server.forEach(staticFiles.serveRequest); <span class="highlight">/*4*/</span>
}</pre>
<div class="prettify-filename">static_file_server.dart</div>

<ol class="code-notes">
  <li>
    <p>Allows clients to request files within the server’s directory.</p>
  </li>
  <li>
    <p>An anonymous function that handles requests for the directory itself, that
is, the URL contains no filename. The function redirects these requests to
<code class="highlighter-rouge">index.html</code>.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">serveFile</code> method serves a file. In this example, it serves
<code class="highlighter-rouge">index.html</code> for directory requests.</p>
  </li>
  <li>
    <p>The <code class="highlighter-rouge">serveRequest</code> method provided by the VirtualDirectory class handles
requests that specify a file.</p>
  </li>
</ol>

<h2 id="using-https">
<a id="using-https" class="anchor" href="#using-https" aria-hidden="true"><span class="octicon octicon-link"></span></a>Using https with bindSecure()</h2>

<p><em>Example for this section:</em>
<a href="https://github.com/dart-lang/dart-tutorials-samples/blob/master/httpserver/bin/hello_world_server_secure.dart">hello_world_server_secure.dart.</a></p>

<p>You might have noticed that the HttpServer class defines a
method called <code class="highlighter-rouge">bindSecure()</code>, which provides a secure connection
using HTTPS (Hyper Text Transfer Protocol with Secure Sockets Layer).
To use the bindSecure() method, you need a certificate,
which is provided by a Certificate Authority (CA).
For more information about certificates refer to
<a href="http://www.tldp.org/HOWTO/SSL-Certificates-HOWTO/x64.html">What is SSL and what are Certificates?</a></p>

<p>For illustrative purposes only,
the following server, <code class="highlighter-rouge">hello_world_server_secure.dart</code>,
calls <code class="highlighter-rouge">bindSecure()</code> using
a certificate created by the Dart team for testing.
You <strong>must</strong> provide your own certificates for your servers.</p>

<?code-excerpt "httpserver/bin/hello_world_server_secure.dart" replace="/\S.*\/\*\d\*\//[!$&!]/g"?>
<pre class="prettyprint lang-dart">import 'dart:io';

String certificateChain = 'server_chain.pem';
String serverKey = 'server_key.pem';

Future main() async {
  <span class="highlight">var serverContext = SecurityContext(); /*1*/</span>
  <span class="highlight">serverContext.useCertificateChain(certificateChain); /*2*/</span>
  <span class="highlight">serverContext.usePrivateKey(serverKey, password: 'dartdart'); /*3*/</span>

  var server = await HttpServer.bindSecure(
    'localhost',
    4047,
    <span class="highlight">serverContext, /*4*/</span>
  );
  print('Listening on localhost:${server.port}');
  await for (HttpRequest request in server) {
    request.response
      ..write('Hello, world!')
      ..close();
  }
}</pre>
<div class="prettify-filename">hello_world_server_secure.dart</div>

<ol class="code-notes">
  <li>
    <p>Optional settings for a secure network connection are specified in a
SecurityContext object. There is a default object,
SecurityContext.defaultContext, that includes trusted root certificates for
well-known certificate authorities.</p>
  </li>
  <li>
    <p>A file containing the chain of certificates from the server certificate up
to the root of the signing authority, in <a href="http://how2ssl.com/articles/working_with_pem_files">PEM format.</a></p>
  </li>
  <li>
    <p>A file containing the (encrypted) server certificate private key, in
<a href="http://how2ssl.com/articles/working_with_pem_files">PEM format.</a></p>
  </li>
  <li>
    <p>The context argument is required on servers, optional for clients. If it is
omitted, then the default context with built-in trusted roots is used.</p>
  </li>
</ol>

<h2 id="other-resources">
<a id="other-resources" class="anchor" href="#other-resources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other resources</h2>

<p>Visit these API docs
for further details about the classes and libraries discussed in this tutorial.</p>

<table class="table">
  <thead>
    <tr>
      <th>Dart class</th>
      <th>Purpose</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpServer-class.html">HttpServer</a></td>
      <td>An HTTP server</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpClient-class.html">HttpClient</a></td>
      <td>An HTTP client</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpRequest-class.html">HttpRequest</a></td>
      <td>A server-side request object</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpResponse-class.html">HttpResponse</a></td>
      <td>A server-side response object</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpClientRequest-class.html">HttpClientRequest</a></td>
      <td>A client-side request object</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpClientResponse-class.html">HttpClientResponse</a></td>
      <td>A client-side response object</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpHeaders-class.html">HttpHeaders</a></td>
      <td>The headers for a request</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/HttpStatus-class.html">HttpStatus</a></td>
      <td>The status of the response</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/InternetAddress-class.html">InternetAddress</a></td>
      <td>An internet address</td>
    </tr>
    <tr>
      <td><a href="https://api.dartlang.org/stable/dart-io/SecurityContext-class.html">SecurityContext</a></td>
      <td>Contains certificates, keys, and trust information for a secure connection</td>
    </tr>
    <tr>
      <td>
<a href="https://pub.dartlang.org/packages/http_server">http_server</a> package</td>
      <td>A package with higher-level HTTP classes</td>
    </tr>
  </tbody>
</table>

<h2 id="what-next">
<a id="what-next" class="anchor" href="#what-next" aria-hidden="true"><span class="octicon octicon-link"></span></a>What next?</h2>

<ul>
  <li>If you haven’t yet tried the server-side codelab,
try <a href="https://dart-lang.github.io/server/codelab/">writing a server app</a>.</li>
  <li>
<a href="https://dart-lang.github.io/server/">Servers with Dart</a>
links to resources for writing standalone Dart applications,
including servers.</li>
</ul>





          
<nav id="subnav">
  <ul>
    <li class="previous">
      
        <a href="/tutorials/server/cmdline">&lang;&nbsp;&nbsp;Write Command-Line Apps</a>
      
    </li>
    <li class="next">
      
    </li>
  </ul>
</nav>


        </div>
      </article>
    </main>
    <footer id="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-md-12 col-lg-3">
        <div class="content">
          <div class="brand">
            <img src="/assets/shared/dart/logo+text/horizontal/mono-004b4974b3112e2d9136b1c457037dfd9fe54e2e69e850d777891e5c2a57a78d.svg" alt="Dart logo" class="brand"/>
          </div>
          <h4><a href="/terms">Terms</a> | <a href="https://policies.google.com/privacy">Privacy</a></h4>
          <style>.menu .material-icons { font-size: 14px; }</style><ul class="menu">
            <li>Site&nbsp;<a href="http://creativecommons.org/licenses/by/3.0/" class="no-automatic-external">CC&nbsp;BY&nbsp;3.0</a></li>
            <li>
              <a href="https://github.com/dartchina/site-www-cn"
                 title="This site's source is on GitHub."
                 class="no-automatic-external"><i class="fab fa-github fa-sm"></i></a>
              &nbsp;
              <a href="https://github.com/dartchina/site-www-cn/issues"
                 title="File an issue about this site."
                 class="no-automatic-external"><i class="fas fa-bug fa-sm"></i></a>
              &nbsp;
              <a 
                 title="Site built on 2019/03/08 21:46 PST"
                 
                 class="no-automatic-external"><i class="material-icons">build</i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-4 col-lg-3">
        <div class="content">
          <h4>技术</h4>
          <ul>
            <li><a href="https://flutterchina.club">Dart 移动开发 (Flutter)</a></li>
            <li><a href="https://webdev.dartlang.org">Dart web 开发</a></li>
            <li><a href="/server">Dart 服务器开发</a></li>
            <li><a href="https://dart-lang.github.io/observatory/">Observatory 工具</a></li>
            <li><a href="/guides/libraries">Dart 库</a></li>
            <li><a href="/guides/language">Dart 编程语言</a></li>
          </ul>
        </div>
      </div>

      <div class="col-md-4 col-lg-3">
        <div class="content">
          <h4>资源</h4>
          <ul>
            <li><a href="https://api.dartlang.org/stable">API 参考</a></li>
            <li><a href="https://dartpad.dartlang.org/">DartPad</a></li>
            <li><a href="https://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://news.dartlang.org/">Dart 新闻</a></li>
            <li><a href="https://github.com/dart-lang/sdk/issues">Dart bugs 和 <br> 新需求</a></li>
          </ul>
        </div>
      </div>

      <div class="col-md-4 col-lg-3">
        <div class="content">
          <h4>社区</h4>
          <ul>
            <li><a href="/community">支持和邮件列表</a></li>
            <li><a href="/community/who-uses-dart">谁在用Dart</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
            <li>G+ <a href="https://plus.google.com/communities/114566943291919232850">社区</a> &
                <a href="https://plus.google.com/b/109866369054280216564/+dartlang">公告组</a></li>
            <li><a href="https://gitter.im/dart-lang/home">Gitter聊天室</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

  </body>
</html>
