<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Language" content="en_US" />
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Learn how to define Dart classes that behave like functions.">
  <title>Emulating Functions in Dart | Dart</title>

  <!-- Favicon / Touch Icons -->
  <link rel="icon" sizes="64x64" href="/assets/shared/dart/icon/64.png">
  <link href="/assets/touch-icon-iphone-a46c306c4fbfae0b28d63f512b01d7cb2ccf1e4ca9d7f3aab15ba1170beed4a0.png" rel="apple-touch-icon">
  <link href="/assets/touch-icon-ipad-d0181720760b3912858b6d40da1d5586b1e92c7c8656a485ea41005674401e6b.png" rel="apple-touch-icon" sizes="76x76">
  <link href="/assets/touch-icon-iphone-retina-3d9821a631425376ac6203dea3c23c1940ab7b5c506a25406662fab76cee2e0b.png" rel="apple-touch-icon" sizes="120x120">
  <link href="/assets/touch-icon-ipad-retina-b9715401952522f1daee2b4a4064a1bbfb5ffab78d0a47a7226dc87444d51c32.png" rel="apple-touch-icon" sizes="152x152">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@dart_lang" />
  <meta name="twitter:title" content="Emulating Functions in Dart" />
  <meta name="twitter:description" content="Learn how to define Dart classes that behave like functions." />

  <!-- Open Graph -->
  <meta property="og:title" content="Emulating Functions in Dart" />
  <meta property="og:description" content="Learn how to define Dart classes that behave like functions." />
  <meta property="og:url" content="https://www.dartlang.org/articles/language/emulating-functions" />
  <meta property="og:image" content="https://www.dartlang.org/assets/shared/dart-logo-for-shares.png?2" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link href='https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" type="text/css" href="/assets/main-743789fa2eea1d0b842284e7e29077de7c7f755aa88e291b7b8bf324a4a2a14b.css">
  <script src="/assets/main-3e89b739cc750412e013252d8b4ced20af281589ffe69a156e6c279177f81069.js" type="text/javascript"></script>
  <script>

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-26406144-4', 'auto');
ga('send', 'pageview');

</script>


</head>

  <body class="default">
    <header id="page-header">
  <nav id="mainnav">
  <div id="menu-toggle"><i class="icon icon-menu"></i></div>
  <a href="/" class="brand" title="Dart">
    <img src="/assets/shared/dart/logo+text/horizontal/default-363c9c133ffb7780463d3d638632b64cc8221d74d93cd1002fb1efbbe9983bc9.svg" alt="Dart">
  </a>
  <ul>
    <li class="mainnav__get-started"><a href="/guides/get-started"><span>入门</span></a></li>
    <li><a href="/guides/language">语言</a></li>
    <li><a href="/guides/libraries">库</a></li>
    <li><a href="/tools">工具</a></li>
    
    
    <li class="dropdown">
      <a class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dart 2</a>
      <ul class="dropdown-menu">
        

<li><a href="https://v1-dartlang-org.firebaseapp.com/articles/language/emulating-functions" class="dropdown-item no-automatic-external">1.24.3&nbsp;&nbsp;(archive)</a></li><li><a class="active dropdown-item">2.1.0&nbsp;&nbsp;(stable)</a></li>

        <li role="separator" class="dropdown-divider"></li>
        <li><a class="dropdown-item" href="/dart-2#migration">迁移指南</a></li>
      </ul>
    </li>
    
    <li class="searchfield">
      <form class="navbar-search" action="/search" id="cse-search-box">
        <input type="hidden" name="cx" value="011220921317074318178:_yy-tmb5t_i">
        <input type="hidden" name="ie" value="UTF-8">
        <input type="hidden" name="hl" value="en">
        <input type="search" name="q" id="q" autocomplete="off" placeholder="Search">
        <button type="submit"><i class="icon icon-search"></i></button>
      </form>
    </li>
  </ul>
</nav>

  
</header>

    <main id="page-content">
      <div id="sidenav" class="">
  <div class="content">
    <a href="/" class="brand" title="Dart">
      <img src="/assets/shared/dart/logo+text/horizontal/default-363c9c133ffb7780463d3d638632b64cc8221d74d93cd1002fb1efbbe9983bc9.svg" alt="Dart">
    </a>

    <div class="sidenav__search">
      <p>
        <a href="/search">Search <i class="icon icon-search"></i></a>
      </p>
    </div>

    <ul>
      <li>
        <a class="btn btn-light" href="/guides/get-started">入门</a>
      </li>
    </ul>
    <h4 ><a href="/guides/language" title="语言">语言</a></h4>
  <ul><li >
          <a href="/guides/language/language-tour" title="概览">概览</a>
        </li>
        
        <li >
          <a href="/guides/language/effective-dart" title="Effective Dart">Effective Dart</a>
          <i class="icon icon-arrow"></i>
          <ul><li >
                <a href="/guides/language/effective-dart/style" title="风格">风格</a>
              </li><li >
                <a href="/guides/language/effective-dart/documentation" title="文档">文档</a>
              </li><li >
                <a href="/guides/language/effective-dart/usage" title="使用">使用</a>
              </li><li >
                <a href="/guides/language/effective-dart/design" title="设计">设计</a>
              </li>
          </ul><li >
          <a href="/samples" title="示例代码">示例代码</a>
        </li>
  </ul><h4 ><a href="/guides/libraries" title="库">库</a></h4>
  <ul><li >
          <a href="/guides/libraries/library-tour" title="概览">概览</a>
        </li>
  </ul><h4 ><a href="/guides/platforms" title="平台">平台</a></h4>
  <ul><li >
          <a href="https://flutter.io" title="移动端 (Flutter)">移动端 (Flutter)</a>
        </li><li >
          <a href="https://webdev.dartlang.org" title="web">web</a>
        </li><li >
          <a href="/dart-vm" title="服务器">服务器</a>
        </li>
  </ul><h4 ><a href="/guides/testing" title="测试">测试</a></h4>
  <ul>
  </ul><h4 >资源</h4>
  <ul><li >
          <a href="/install" title="安装">安装</a>
        </li><li >
          <a href="/codelabs" title="Codelabs">Codelabs</a>
        </li><li >
          <a href="/tutorials" title="学习指南">学习指南</a>
        </li><li class="active">
          <a href="/articles" title="文章">文章</a>
        </li><li >
          <a href="/tools" title="工具">工具</a>
        </li><li >
          <a href="/community" title="社区支持">社区支持</a>
        </li>
  </ul>
  </div>
</div>

      
<div id="toc">
  <div class="content">
    <header class="h4 text-uppercase">
      目录
      <a title="Back to top" class="back-to-top float-right mr-3">
        <i class="fas fa-angle-up"></i>
      </a>
    </header>
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#the-call-method">The call() method</a>
<ul>
<li class="toc-entry toc-h3"><a href="#how-does-it-work">How does it work?</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#the-apply-method">The apply() method</a></li>
<li class="toc-entry toc-h2"><a href="#symbols">Symbols</a></li>
<li class="toc-entry toc-h2"><a href="#interactions-with-mirrors-and-nosuchmethod">Interactions with mirrors and noSuchMethod()</a></li>
<li class="toc-entry toc-h2"><a href="#summary">Summary</a></li>
</ul>
  </div>
</div>


      <article>
        <div class="content">
           <div class="banner alert alert-info">
  <p class="banner__text">
    
    
    Dart 2.1 现发布，具有更高的性能和可用性。
    <a href="https://medium.com/dartlang/announcing-dart-2-1-improved-performance-usability-9f55fca6f31a">了解更多。</a>
  </p>
</div>
 
          

          <div>
            <div id="page-github-links" class="btn-group" aria-label="Page GitHub links" role="group">
  <a href="https://github.com/dartchina/site-www-cn/tree/src_zh_CN/src_zh_CN/_articles/language/emulating-functions.md" class="btn no-automatic-external" title="View page source" target="_blank" rel="noopener">
    <i class="fas fa-file-alt fa-sm"></i>
  </a>
  <a href="https://github.com/dartchina/site-www-cn/issues/new?title='Emulating Functions in Dart' page issue&body=
Page URL: https://www.dartlang.org/articles/language/emulating-functions%0D%0A
Page source: https://github.com/dartchina/site-www-cn/tree/src_zh_CN/src_zh_CN/_articles/language/emulating-functions.md%0D%0A
%0D%0A
<!-- ADD YOUR DESCRIPTION OF THE PAGE ISSUE HERE: -->" class="btn no-automatic-external" title="Report a issue with this page"
    target="_blank" rel="noopener">
    <i class="fas fa-bug fa-sm"></i>
  </a>
</div>

            <h1>Emulating Functions in Dart</h1>
          </div>
          <p><em>Written by Gilad Bracha <br>
January 2012 (updated September 2018)</em></p>

<p>This document describes how to define Dart classes
that behave like functions.</p>

<h2 id="the-call-method">
<a id="the-call-method" class="anchor" href="#the-call-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>The call() method</h2>

<p>The following example has an ordinary class, <code class="highlighter-rouge">WannabeFunction</code>, that
defines a method named <code class="highlighter-rouge">call()</code>.</p>

<?code-excerpt "misc/lib/articles/emulating-functions/emulating-functions.dart (call-method)"?>
<pre class="prettyprint lang-dart">class WannabeFunction {
  int call(int a, int b) =&gt; a + b;
}</pre>

<p>The <code class="highlighter-rouge">call()</code> method is special, in that anyone who defines a <code class="highlighter-rouge">call()</code> method is
presumed to emulate a function. This allows us to use instances of
<code class="highlighter-rouge">WannabeFunction</code> as if they were functions that take two integer arguments
and return an integer:</p>

<?code-excerpt "misc/lib/articles/emulating-functions/emulating-functions.dart (call-object-as-function)"?>
<pre class="prettyprint lang-dart">var wf = WannabeFunction();
assert(wf(3, 4) == 7);</pre>

<p>The example above is rather trivial, and we would be better off writing a
function directly. However, there are cases where this ability can be quite
useful.  It is also core to the design philosophy of the Dart language:</p>

<ul>
  <li>What matters about an object is its behavior. If object <em>a</em> has a procedural
interface that is compatible with that of another object <em>b</em>, <em>a</em> may
substitute for <em>b</em>.</li>
  <li>The interface of any kind of object can always be emulated by another
suitably defined object.</li>
</ul>

<h3 id="how-does-it-work">
<a id="how-does-it-work" class="anchor" href="#how-does-it-work" aria-hidden="true"><span class="octicon octicon-link"></span></a>How does it work?</h3>

<p>When <code>x(a<sub>1</sub>, .., a<sub>n</sub>)</code> is evaluated,
if it is a normal
function, it gets called in the normal way. If it isn’t we just invoke <code class="highlighter-rouge">call()</code>
on it. If <code class="highlighter-rouge">x</code> supports a <code class="highlighter-rouge">call()</code> method with suitable arguments it gets called.
Otherwise, <code class="highlighter-rouge">noSuchMethod()</code> gets invoked.</p>

<p>Assignment is different.
When an object that supports <code class="highlighter-rouge">call()</code> is assigned to a target that
has a function type, the object is converted to a function object.
More precisely, when <code class="highlighter-rouge">e</code>
(an expression that has a type with a <code class="highlighter-rouge">call</code> method)
is assigned to a variable
(or passed as a parameter, or returned,
or used to initialize something, etc.)
<strong>and</strong> the type of the target is a function type,
then <code class="highlighter-rouge">e</code> is implicitly transformed to <code class="highlighter-rouge">e.call</code> —
a tear-off operation that yields a function object.</p>

<h2 id="the-apply-method">
<a id="the-apply-method" class="anchor" href="#the-apply-method" aria-hidden="true"><span class="octicon octicon-link"></span></a>The apply() method</h2>

<p>The class Function defines the static method <code class="highlighter-rouge">apply()</code>
with the following signature:</p>

<pre class="prettyprint lang-dart">static apply(Function function,
                      List positionalArguments,
                      [Map&lt;Symbol, dynamic&gt; namedArguments]);</pre>

<p>The apply() function allows functions to be called in generic fashion. The
last argument is positional, and is only needed if the function we mean to
call takes named arguments.  These are provided via map from argument names to
their values. One thing to pay attention to is that names are described
via instances of class <a href="https://api.dartlang.org/stable/dart-core/Symbol-class.html">Symbol</a>.</p>

<h2 id="symbols">
<a id="symbols" class="anchor" href="#symbols" aria-hidden="true"><span class="octicon octicon-link"></span></a>Symbols</h2>

<p>You can create symbols from strings:</p>

<pre class="prettyprint lang-dart">new Symbol('myFavoriteMethodName');</pre>

<p>If possible, create constant symbol objects:</p>

<pre class="prettyprint lang-dart">const Symbol('myFavoriteMethodName');</pre>

<p>Using constant symbols helps dart2js minify your code.</p>

<h2 id="interactions-with-mirrors-and-nosuchmethod">
<a id="interactions-with-mirrors-and-nosuchmethod" class="anchor" href="#interactions-with-mirrors-and-nosuchmethod" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interactions with mirrors and noSuchMethod()</h2>

<p>In Dart, you can customize how objects react to methods that are not explicitly
defined in their class chain by overriding noSuchMethod(). Here’s an example
showing how you could use function emulation inside noSuchMethod():</p>

<?code-excerpt "misc/lib/articles/emulating-functions/emulating-functions.dart (no-such-method)"?>
<pre class="prettyprint lang-dart">@override
dynamic noSuchMethod(Invocation invocation) {
  return invocation.memberName == #foo
      ? Function.apply(
          baz, invocation.positionalArguments, invocation.namedArguments)
      : super.noSuchMethod(invocation);
}</pre>

<p>The first branch handles the case where you want to forward just the parameters to
another function. If you know <code class="highlighter-rouge">baz</code> doesn’t take any named arguments,
then that code can instead be
<code class="highlighter-rouge">Function.apply(baz, invocation.positionalArguments)</code>. The second branch simply forwards
to the standard implementation of the noSuchMethod(), a common pattern.</p>

<p>The only argument to noSuchMethod() is an
<a href="https://api.dartlang.org/stable/dart-core/Invocation-class.html">Invocation</a>.
The boolean properties of Invocation identify the syntactic form of the
method invocation, as the following table shows.</p>

<!-- TODO: move this to stylesheet -->
<style type="text/css">
  .property-table { margin-bottom: 20px;}
  .property-table td {border: 1px solid #bbb; text-align: center;}
  .property-table td.true {background: #d9f2db;}
  .property-table td.false {background: #ffbfbf;}
</style>

<table class="property-table">
<tr>
  <th> </th>
  <th colspan="3">Form of method invocation</th>
</tr>
<tr>
  <th> </th>
<th>x.y</th>
<th>x.y = e</th>
<th>x.y(...)</th>
</tr>
<tr>
  <th align="left">isMethod</th>
  <td class="false"> false </td> <!-- x.y -->
  <td class="false"> false </td> <!-- x.y = e -->
  <td class="true"> true </td>   <!-- x.y(...) -->
</tr>
<tr>
  <th align="left">isGetter</th>
  <td class="true"> true </td>   <!-- x.y -->
  <td class="false"> false </td> <!-- x.y = e -->
  <td class="false"> false </td> <!-- x.y(...) -->
</tr>
<tr>
  <th align="left">isSetter</th>
  <td class="false"> false </td> <!-- x.y -->
  <td class="true"> true </td>   <!-- x.y = e -->
  <td class="false"> false </td> <!-- x.y(...) -->
</tr>
<tr>
  <th align="left">isAccessor</th>
  <td class="true"> true </td>   <!-- x.y -->
  <td class="true"> true </td>   <!-- x.y = e -->
  <td class="false"> false </td> <!-- x.y(...) -->
</tr>
</table>

<p>It is important not to assume that <code class="highlighter-rouge">isMethod</code> means that a non-accessor was
being looked up, since in fact, Dart semantics mean that we would have called
noSuchMethod() only if neither a normal method nor a getter were found.
Likewise, <code class="highlighter-rouge">isGetter</code> does not imply a getter was being looked up; if a method
was present, it would be closurized and returned.</p>

<h2 id="summary">
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Summary</h2>

<p>Here is what you need to know to
define a class that works similarly to a function in Dart:</p>

<ol>
  <li>Define a class with a method named <strong>call</strong>.</li>
  <li>Implement the <code class="highlighter-rouge">call()</code> method to define
what instances of your class do
when invoked as functions via the <strong>()</strong> syntax.</li>
</ol>


          

        </div>
      </article>
    </main>
    <footer id="page-footer">
  <div class="container">
    <div class="row">
      <div class="col-md-12 col-lg-3">
        <div class="content">
          <div class="brand">
            <img src="/assets/shared/dart/logo+text/horizontal/mono-004b4974b3112e2d9136b1c457037dfd9fe54e2e69e850d777891e5c2a57a78d.svg" alt="Dart logo" class="brand"/>
          </div>
          <h4><a href="/terms">Terms</a> | <a href="https://policies.google.com/privacy">Privacy</a></h4>
          <style>.menu .material-icons { font-size: 14px; }</style><ul class="menu">
            <li>Site&nbsp;<a href="http://creativecommons.org/licenses/by/3.0/" class="no-automatic-external">CC&nbsp;BY&nbsp;3.0</a></li>
            <li>
              <a href="https://github.com/dartchina/site-www-cn"
                 title="This site's source is on GitHub."
                 class="no-automatic-external"><i class="fab fa-github fa-sm"></i></a>
              &nbsp;
              <a href="https://github.com/dartchina/site-www-cn/issues"
                 title="File an issue about this site."
                 class="no-automatic-external"><i class="fas fa-bug fa-sm"></i></a>
              &nbsp;
              <a 
                 title="Site built on 2018/11/29 12:13 CST"
                 
                 class="no-automatic-external"><i class="material-icons">build</i></a>
            </li>
          </ul>
        </div>
      </div>
      <div class="col-md-4 col-lg-3">
        <div class="content">
          <h4>技术</h4>
          <ul>
            <li><a href="https://flutter.io">Dart 移动开发 (Flutter)</a></li>
            <li><a href="https://webdev.dartlang.org">Dart web 开发</a></li>
            <li><a href="/dart-vm">Dart 服务器开发</a></li>
            <li><a href="https://dart-lang.github.io/observatory/">Observatory 工具</a></li>
            <li><a href="/guides/libraries">Dart 库</a></li>
            <li><a href="/guides/language">Dart 编程语言</a></li>
          </ul>
        </div>
      </div>

      <div class="col-md-4 col-lg-3">
        <div class="content">
          <h4>资源</h4>
          <ul>
            <li><a href="https://api.dartlang.org/stable">API 参考</a></li>
            <li><a href="https://dartpad.dartlang.org/">DartPad</a></li>
            <li><a href="https://pub.dartlang.org/">Pub packages</a></li>
            <li><a href="http://news.dartlang.org/">Dart 新闻</a></li>
            <li><a href="https://github.com/dart-lang/sdk/issues">Dart bugs 和 <br> 新需求</a></li>
          </ul>
        </div>
      </div>

      <div class="col-md-4 col-lg-3">
        <div class="content">
          <h4>社区</h4>
          <ul>
            <li><a href="/community">支持和邮件列表</a></li>
            <li><a href="/community/who-uses-dart">谁在用Dart</a></li>
            <li><a href="http://stackoverflow.com/questions/tagged/dart">Stack Overflow</a></li>
            <li>G+ <a href="https://plus.google.com/communities/114566943291919232850">社区</a> &
                <a href="https://plus.google.com/b/109866369054280216564/+dartlang">公告组</a></li>
            <li><a href="https://gitter.im/dart-lang/home">Gitter聊天室</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</footer>

  </body>
</html>
